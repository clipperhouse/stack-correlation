var api_cache={};$.ajaxSetup({cache:!0}),getJSONCached=function(e,t){var a=api_cache[e];if(null!=a)return t&&t(a);var i=function(a){return api_cache[e]=a,t&&t(a)};return $.getJSON(e+"&callback=?",i)};var api_base_url="//api.stackexchange.com/2.2/",api_key_param="&key=zg)SFUiAw3KznQKAw)AXzQ((",urls={api_sites:function(e){return api_base_url+"sites?page="+e+"&pagesize=100&filter=!0U12eE-l6vTXjGb9hog*DtBLF"+api_key_param},api_tags:function(e,t){return api_base_url+"tags?pagesize=16&order=desc&sort=popular&inname="+encodeURIComponent(t)+"&site="+e.api_site_parameter+"&filter=!*M27MxijjqVg4jGo"+api_key_param},api_tags_popular:function(e){return api_base_url+"tags?pagesize=5&order=desc&sort=popular&site="+e.api_site_parameter+"&filter=!*M27MxijjqVg4jGo"+api_key_param},api_tag_count:function(e,t){return api_base_url+"questions?order=desc&sort=activity&tagged="+encodeURIComponent(t)+"&site="+e.api_site_parameter+"&filter=!LQa0AXyWeCS0eBBhfz)UnE"+api_key_param},api_tags_related:function(e,t){return api_base_url+"tags/"+encodeURIComponent(t)+"/related?site="+e.api_site_parameter+"&pagesize=10&filter=!n9Z4Y*b7KJ"+api_key_param},site_tag:function(e,t){return e.site_url.replace("http:","")+"/tags/"+encodeURIComponent(t)+"/info"},wikipedia_search:function(e){return"//en.wikipedia.org/w/index.php?search="+encodeURIComponent(e.replace(/\-/g," ").replace("#"," sharp"))}},round=function(e,t){for(var a=(Math.round(e*Math.pow(10,t))/Math.pow(10,t)).toString();a.split(".").length>1&&a.split(".")[1].length<t;)a+="0";return a},state={},sites={},doc=$(document);doc.on("ready",function(){getJSONCached(urls.api_sites(1),function(e){console.log(e);for(var t=e.items,a=t.length,i=0;a>i;i++){var r=t[i];"main_site"===r.site_type&&0!==r.name.indexOf("Meta")&&"normal"===r.site_state&&(r.favicon_url=r.favicon_url.replace("http:",""),sites[r.api_site_parameter]=r)}doc.trigger("sites:load")})});var menu=$("#menu");doc.on("sites:load",function(){for(var e in sites)if(sites.hasOwnProperty(e)){var t=sites[e],a=$("<a>").attr("href","#"+t.api_site_parameter).attr("id",t.api_site_parameter).html(t.name).css("background-image","url("+t.favicon_url+")");menu.append(a),t.a=a}menu.show(),doc.trigger("menu:load")}),doc.on("menu:load",function(){pop(),window.onpopstate=pop});var pop=function(){var e=parseUrl(location.href);return e.site?void transition(e):(e.site=menu.children().eq(0).data("site"),void transition(e))},parseUrl=function(e){var t={},i=e.split("#");if(i.length<2)return t;var r=i[1];return i=r.split("/"),spec.a=getMenuItem(i[0]),spec.a&&(spec.site=spec.a.data("site")),spec.site=a?a.data("site"):null,i.length>1&&(spec.tag=i[1]),spec},header=$("h1"),siteName=$(".site-name"),tagName=$(".tag-name"),tagCorrelations=$("#tag-correlations"),title=$("title"),popular=$("#popular"),links=$("#tag-links"),transition=function(e){setSiteUI(e.site),state.site=e.site,loadPopularTags(site),e.tag?(loadTag(site,tag),tagInput.val(tag)):(tagInput.val("").attr("placeholder","type a tag name here"),tagCorrelations.html(""),links.hide(),popular.show()),tagInput.focus().select()},getMenuItem=function(e){for(var t=menu.children(),a=0;a<t.length;a++){var i=$(t[a]),r=t.data("site");if(r.api_site_parameter===e)return i}return t.first()},setSiteUI=function(e){e.addClass("selected").siblings().removeClass("selected");var t=e.data("site");siteName.html(t.name),header.css("background-image","url("+t.favicon_url.replace("http:","")+")")},loadPopularTags=function(e){getJSONCached(urls.api_tags_popular(e),function(e){popular.html("Popular: &nbsp;");for(var t=e.items,a=t.length,i=0;a>i;i++){item=t[i];var r=$("<a>").attr("href","#"+state.site.api_site_parameter+"/"+item.name).addClass("tag").html(item.name);popular.append(r).append("&nbsp;")}})},loadTag=function(e,t){getJSONCached(urls.api_tag_count(e,t),function(a){loadCorrelations(e,t,a.total)})},soLink=links.find("a#so"),wikipediaLink=links.find("a#wikipedia"),loadCorrelations=function(e,t,a){getJSONCached(urls.api_tags_related(e,t),function(i){for(var r=[],n=i.items,s=n.length,o=0;s>o;o++)item=n[o],r.push({tag:item.name,site:e.api_site_parameter,favicon:e.favicon_url.replace("http:",""),url:e.site_url.replace("http:","")+"/questions/tagged/"+encodeURIComponent(t)+"+"+encodeURIComponent(item.name),correlation:0==o?"appears on "+round(100*item.count/a,0)+"% of ‘"+t+"’ questions":round(100*item.count/a,0)+"%"});var p={correlations:r},l=$("#correlations-tmpl").html(),u=Mustache.to_html(l,p);tagCorrelations.hide().html(u).fadeIn("fast"),popular.hide(),tagName.html(t),soLink.attr("href",urls.site_tag(e,t)),wikipediaLink.attr("href",urls.wikipedia_search(t)),links.show()})},tagInput=$("input[name=tag]");tagInput.autocomplete({source:function(e,t){getJSONCached(urls.api_tags(state.site,e.term),function(e){for(var a=[],i=e.items,r=i.length,n=0;r>n;n++)item=i[n],a.push({label:item.name,value:item.name,spec:state.site.api_site_parameter+"/"+item.name});t(a)})},select:function(e,t){location.href="#"+t.item.spec},autoFocus:!0,delay:200}),doc.on("mouseover","a.tag",function(){preFetchTag($(this))});var preFetchTag=function(e){var t=e.attr("href"),a=t.split("#");if(!(a.length<2)){var i=a[1];if(a=i.split("/"),!(a.length<2)){var r=getMenuItem(a[0]).data("site"),n=a[1];getJSONCached(urls.api_tag_count(r,n),null),getJSONCached(urls.api_tags_related(r,n),null)}}};
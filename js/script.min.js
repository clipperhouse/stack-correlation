var api_cache;$.fn.addSiteOption=function(n){return $(this).append($("<li/>").data("site",n).html(n.name).css("background-image","url("+n.favicon_url+")"))};api_cache={};$.getJSONCached=function(n,t){var i,r;return(i=api_cache[n],i!=null)?t(i):(r=function(i){return t(i),api_cache[n]=i},$.getJSON(n+"&callback=?",r))};$(function(){var t,o,v,s,h,c,y,f,i,r,p,n,l,a,w,e,u;f=$("#sites");w=$("#tag-count");l=$("#site-name");e=$("input[name=tag]");n={};a=$("#tag-correlations > tbody");t="zg)SFUiAw3KznQKAw)AXzQ((";u={api_sites:function(n){return"http://api.stackexchange.com/2.1/sites?page="+n+"&pagesize=100&filter=!0U12eE-l6vTXjGb9hog*DtBLF&key="+t},api_tags:function(n,i){return"http://api.stackexchange.com/2.1/tags?pagesize=16&order=desc&sort=popular&inname="+encodeURIComponent(i)+"&site="+n.api_site_parameter+"&filter=!*M27MxijjqVg4jGo&key="+t},api_tag_count:function(n,i){return"http://api.stackexchange.com/2.1/questions?order=desc&sort=activity&tagged="+encodeURIComponent(i)+"&site="+n.api_site_parameter+"&filter=!LQa0AXyWeCS0eBBhfz)UnE&key="+t},api_tags_related:function(n,i){return"http://api.stackexchange.com/2.1/tags/"+encodeURIComponent(i)+"/related?site="+n.api_site_parameter+"&key="+t+"&filter=!n9Z4Y*b7KJ"}};p=function(n,t){for(var i=(Math.round(n*Math.pow(10,t))/Math.pow(10,t)).toString();i.split(".").length>1&&i.split(".")[1].length<t;)i+="0";return i};c=function(n){return n==null&&(n=1),$.getJSONCached(u.api_sites(n),function(t){var i,r,e,u;for(u=t.items,r=0,e=u.length;r<e;r++)i=u[r],i.site_type==="main_site"&&i.name.indexOf("Meta")!==0&&i.site_state==="normal"&&f.addSiteOption(i);return f.show(),t.has_more?c(n+1):void 0})};y=function(n,t){if(t==null&&a.html(""),t!=null&&n!=null)return $.getJSONCached(u.api_tag_count(n,t),function(i){return v(n,t,i.total)})};v=function(t,i,r){return $.getJSONCached(u.api_tags_related(t,i),function(u){var o,s,f,h;return h=$("#correlations-tmpl").html(),o={items:function(){var e,h,o,s;for(o=u.items,s=[],e=0,h=o.length;e<h;e++)f=o[e],s.push({tag_current:i,tag:f.name,site:n.api_site_parameter,url:t.site_url+"/questions/tagged/"+encodeURIComponent(i)+"+"+encodeURIComponent(f.name),correlation:p(f.count/r,2)});return s}()},s=Mustache.to_html(h,o),a.hide().html(s).fadeIn("fast"),e.focus().select()})};s=function(n){return n==null||n.length===0?null:f.children("li").filter(function(){return $(this).data("site").api_site_parameter===n})};h=function(n){return n==null||n.length===0?null:s(n).data("site")};c();e.autocomplete({source:function(t,i){return $.getJSONCached(u.api_tags(n,t.term),function(n){var t,r;return r=function(){var i,f,r,u;for(r=n.items,u=[],i=0,f=r.length;i<f;i++)t=r[i],u.push({label:t.name,value:t.name});return u}(),i(r)})},select:function(t,i){return r(n,i.item.value)},autoFocus:!0,delay:200});$("input.deletable").wrap('<span class="deleteicon" />').after($("<a/>").click(function(){return $(this).prev("input").val("").focus(),r(n)}));$(document).on("click","#sites > li",function(){return r($(this).data("site"))});$(document).on("click","a.correlation",function(){return setTimeout(i,1)});$(document).on("click",'a[href^="#"]',function(){return setTimeout(i,1)});return window.onpopstate=i,i=function(){var t,i,r,u,n;return i=location.hash.replace(/^#+/,""),n=i.split("/"),t=n[0],u=n[1],r=h(t),o(r,u)},r=function(n,t){var i;return i="",n!=null&&(i+=n.api_site_parameter),t!=null&&(i+="/"+t),i.length&&(i="#"+i),history.pushState!=null&&history.pushState({hash:i},null,i),o(n,t)},o=function(t,i){return n=t,l.html(n.name),l.css("background-image","url("+n.favicon_url+")"),s(n.api_site_parameter).addClass("selected").siblings().removeClass("selected"),e.val(i).focus().select(),y(t,i)},setTimeout(function(){return location.hash.length<=1&&r(h("stackoverflow")),i()},400)})
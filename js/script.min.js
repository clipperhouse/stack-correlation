(function(e){var t={};e.ajaxSetup({cache:true});getJSONCached=function(n,r){var i=t[n];if(i!=null){return r&&r(i)}var s=function(e){t[n]=e;return r&&r(e)};return e.getJSON(n+"&callback=?",s)};var n="//api.stackexchange.com/2.2/";var r="&key=zg)SFUiAw3KznQKAw)AXzQ((";var i={api_sites:function(e){return n+"sites?page="+e+"&pagesize=100&filter=!0U12eE-l6vTXjGb9hog*DtBLF"+r},api_tags:function(e,t){return n+"tags?pagesize=16&order=desc&sort=popular&inname="+encodeURIComponent(t)+"&site="+e.api_site_parameter+"&filter=!*M27MxijjqVg4jGo"+r},api_tags_popular:function(e){return n+"tags?pagesize=5&order=desc&sort=popular&site="+e.api_site_parameter+"&filter=!*M27MxijjqVg4jGo"+r},api_tag_count:function(e,t){return n+"questions?order=desc&sort=activity&tagged="+encodeURIComponent(t)+"&site="+e.api_site_parameter+"&filter=!LQa0AXyWeCS0eBBhfz)UnE"+r},api_tags_related:function(e,t){return n+"tags/"+encodeURIComponent(t)+"/related?site="+e.api_site_parameter+"&pagesize=10&filter=!n9Z4Y*b7KJ"+r},site_tag:function(e,t){return e.site_url.replace("http:","")+"/tags/"+encodeURIComponent(t)+"/info"},wikipedia_search:function(e){return"//en.wikipedia.org/w/index.php?search="+encodeURIComponent(e.replace(/\-/g," ").replace("#"," sharp"))}};var s=function(e,t){var n=(Math.round(e*Math.pow(10,t))/Math.pow(10,t)).toString();while(n.split(".").length>1&&n.split(".")[1].length<t){n+="0"}return n};var o={};var u={};var a=null;var f=e(document);var l,c,h,p,d,v,m,g,y,b,w;f.on("ready",function(){getJSONCached(i.api_sites(1),function(e){var t=e.items;var n=t.length;for(var r=0;r<n;r++){var i=t[r];if(i.site_type==="main_site"&&i.name.indexOf("Meta")!==0&&i.site_state==="normal"){i.favicon_url=i.favicon_url.replace("http:","");u[i.api_site_parameter]=i;if(a==null){a=i}}}f.trigger("sites:load")});l=e("#menu");c=e("h1 > a");w=e("input[name=tag]");h=e(".site-name");p=e(".tag-name");d=e("#tag-correlations");v=e("title");m=e("#popular");g=e("#tag-links");y=g.find("a#so");b=g.find("a#wikipedia");w.autocomplete({source:function(e,t){getJSONCached(i.api_tags(o.site,e.term),function(e){var n=[];var r=e.items;var i=r.length;for(var s=0;s<i;s++){item=r[s];n.push({label:item.name,value:item.name,href:"#"+o.site.api_site_parameter+"/"+encodeURIComponent(item.name)})}t(n)})},select:function(e,t){location.href=t.item.href},autoFocus:true,delay:200})});f.on("sites:load",function(){for(var t in u){if(u.hasOwnProperty(t)){var n=u[t];var r=e("<a>").attr("href","#"+n.api_site_parameter).html(n.name).css("background-image","url("+n.favicon_url+")");l.append(r);n.a=r}}l.show();f.trigger("menu:load")});f.on("menu:load",function(){E();window.onpopstate=E});var E=function(){var e=S(location.href);x(e)};var S=function(e){var t={};var n=e.split("#");if(n.length<2){t.site=a;return t}var r=n[1];n=r.split("/");var i=u[n[0]];if(i){t.site=i}else{}if(n.length>1){t.tag=decodeURIComponent(n[1])}return t};var x=function(e){o=e;T(o.site);if(o.tag){C(o.site,o.tag);w.val(o.tag)}else{w.val("").attr("placeholder","type a tag name here");d.html("");g.hide();N(o.site)}w.focus().select()};var T=function(e){e.a.addClass("selected").siblings().removeClass("selected");h.html(e.name);c.css("background-image","url("+e.favicon_url+")").attr("href","#"+e.api_site_parameter)};var N=function(t){getJSONCached(i.api_tags_popular(t),function(t){m.html("Popular: &nbsp;");var n=t.items;var r=n.length;for(var i=0;i<r;i++){item=n[i];var s=e("<a>").attr("href","#"+o.site.api_site_parameter+"/"+encodeURIComponent(item.name)).addClass("tag").html(item.name);m.append(s).append("&nbsp;")}m.show()})};var C=function(e,t){getJSONCached(i.api_tag_count(e,t),function(n){k(e,t,n.total)})};var k=function(t,n,r){getJSONCached(i.api_tags_related(t,n),function(o){var u=[];var a=o.items;var f=a.length;for(var l=0;l<f;l++){item=a[l];u.push({tag:item.name,href:"#"+t.api_site_parameter+"/"+encodeURIComponent(item.name),site:t.api_site_parameter,favicon:t.favicon_url.replace("http:",""),url:t.site_url.replace("http:","")+"/questions/tagged/"+encodeURIComponent(n)+"+"+encodeURIComponent(item.name),correlation:l==0?"appears on "+s(100*item.count/r,0)+"% of ‘"+n+"’ questions":s(100*item.count/r,0)+"%"})}var c={correlations:u};var h=e("#correlations-tmpl").html();var v=Mustache.to_html(h,c);d.hide().html(v).fadeIn("fast");m.hide();p.html(n);y.attr("href",i.site_tag(t,n));b.attr("href",i.wikipedia_search(n));g.show()})};f.on("mouseover","a.tag",function(){L(e(this))});var L=function(e){var t=S(e.attr("href"));getJSONCached(i.api_tag_count(t.site,t.tag),null);getJSONCached(i.api_tags_related(t.site,t.tag),null)}})(jQuery)